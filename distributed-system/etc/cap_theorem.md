# CAP THEOREM

먼저 CAP가 각각 뭔지 알아보면<br>
C: consistency 일관성<br>
A: availability 가용성<br>
P: partition tolerance 분할 용인<br>

- Consistency: 읽기 시 모든 노드가 가장 최신의 데이터를 제공하지만 에러를 제공할 수도 있다
- Availability: 읽기 시 모든 노드가 에러가 아닌 데이터를 제공하지만 가장 최신의 데이터가 아닐 수있다.
- Partition tolerance: 노드간의 메세지 전송중 에러를 허용한다.

CAP는 분산시스템 설계에서 기술적인 선택을 돕는다. 분산시스템이 모든 것 특성을 만족시킬 수 없음을 인지하게 하고 선택지를 제공해주는 것이다.

근데 P를 허용하지않으면 노드간의 메세지 전송중 절대로 장애가 나지 않는 네트워크를 구성해야 하지만 그런 것은 이 세상에 존재하지 않는다. 따라서 원하든 원하지 않든 P는 선택되어야 하며 결국 선택권은 C나 A중 하나밖에 없다.

또 C와 A가 비대칭적이다. AP를 선택한 것으로 많이 알려진 Cassandra를 예로 들어, Cassandra는 네트워크 장애 상황이든 정상 상황이든 C를 포기하도록 되어있다. HBase의 경우에는 장애상황일 때만 A를 포기하고 정상일 때는 A를 만족한다. CAP Theorem은 네트워크가 장애 상황일 때만 대칭성이 있고 정상일 때에는 그렇지 않다.

그래서 위 문제들을 해결하기 위해 차라리 장애상황일때랑 아닐때랑 나눠서 설명하자 나온게 PACELC이다

# PACELC

![image](https://user-images.githubusercontent.com/81360154/210206151-cdc9bb50-966a-4280-937b-b92a2b4e1e58.png)
사진에서 볼 수 있듯이 장애상황일때(P)는 A or C 정상상활일때는(else) L or C ACP는 그대로고 L은 latency를 의미한다. 

latency와 consistenct중 택1을 해야하는 이유는모든 노드들에 새로운 데이터를 반영하는 것은 상대적으로 긴 응답시간이 필요하기 때문이다

NoSql시스템에 적용하면
- HBase는 PC/EC이다. 장애 상황일때 C를 위해 A를 희생한다. 그렇지 않은 경우에도 C를 위해 L을 희생한다.
- Cassandra는 PA/EL이 가능하도록 디자인 되었다. 설정에 따라 Eventual Consistency의 특성을 가지게 되는데, 이 경우 PA/EL이 된다. 장애 상황인 경우에는 가능한 노드에만 데이터를 반영하고 정상으로 복구되면 필요한 노드에 데이터를 모두 반영한다. 정상상황일때도 Latency를 위해 모든 노드에 데이터를 반영하지 않는다.
- Brewer가 제시한 가상의 분산시스템은 PA/EC이다. 정상적인 경우에는 모든 노드에서 같은 메세지를 볼 수 있도록 쓰기 연산이 일어나는데 P 상황인 경우, 이를 판단하여 일단 접근 가능한 만큼만 데이터를 반영한다 결과적으로 시스템은 디운되지 않지만 절단된 노드들 끼리는 데이터를 주고 받지 못하게 된다. 장애상황이 복구되면 이를 감지하여 전달하지 못한 데이터를 반영한다. 장애상황일때에만 C를 포기하고 보통의 상황에서는 강력한 C를 가져가는 것이다.